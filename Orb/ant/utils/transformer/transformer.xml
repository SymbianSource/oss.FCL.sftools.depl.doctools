<project name="transformerlib">
<!-- Copyright (c) 2007-2010 Nokia Corporation and/or its subsidiary(-ies) All rights reserved. -->
<!-- This component and the accompanying materials are made available under the terms of the License 
"Eclipse Public License v1.0" which accompanies this distribution, 
and is available at the URL "http://www.eclipse.org/legal/epl-v10.html". -->
<!-- Initial Contributors:
	Nokia Corporation - initial contribution.
Contributors: 
-->    
    <description>Library for transform tool</description>
	<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
    <tstamp>
    	<format property="TODAY_UK" pattern="yyyy-MM-dd H:m:s" locale="en,UK"/>
	</tstamp>
    
    <!-- Set basedir for this project so resources can be imported relatively -->
	<dirname property="transformerlib.basedir" file="${ant.file.transformerlib}"/>
	<property file="${transformerlib.basedir}/transformer.properties"/>
	
	<!-- Import the catalog to use for transformation - configured in transformer.properties -->
	<echo message="Using XML catalog ${transformerlib.basedir}/${catalog}"/>
	<import file="${transformerlib.basedir}/${catalog}"/>
	
    <!-- = = = = = = = = = = = = = = = = =
    macrodef: transform
    = = = = = = = = = = = = = = = = = -->	
    <macrodef name="transform">
        <attribute name="input"/>
        <attribute name="output"/>
        <attribute name="logdir" default="."/>
		<attribute name="logfilename" default="transform-log.txt"/>
        <attribute name="includes" default="**/*.*"/>
        <attribute name="style"/>
        <attribute name="catalog-id" default="${catalog-id}"/>
        <sequential>
        	<record name="@{logdir}/@{logfilename}" loglevel="error" action="start"/>
	        <xslt
			 basedir="@{input}"
	         destdir="@{output}"
	         style="@{style}"
	         includes="@{includes}">
				<mapper type="identity"/>
				<param name="datetime" expression="${TODAY_UK}"/>
				<xmlcatalog refid="@{catalog-id}"/>
	        </xslt>
			<record name="@{logdir}/@{logfilename}" action="stop"/>
        </sequential>
    </macrodef>
</project>