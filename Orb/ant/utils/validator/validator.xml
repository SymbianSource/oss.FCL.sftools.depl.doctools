<?xml version="1.0" encoding="UTF-8"?> 
<project name="validatorlib" basedir=".">
<!-- Copyright (c) 2007-2010 Nokia Corporation and/or its subsidiary(-ies) All rights reserved. -->
<!-- This component and the accompanying materials are made available under the terms of the License 
"Eclipse Public License v1.0" which accompanies this distribution, 
and is available at the URL "http://www.eclipse.org/legal/epl-v10.html". -->
<!-- Initial Contributors:
	Nokia Corporation - initial contribution.
Contributors: 
-->    	
    <description>Library for validator tool</description>
	
	<!-- for "if" statement -->
	<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>
	
	<!-- Set basedir for this project so resources can be imported relatively -->
	<dirname property="validatorlib.basedir" file="${ant.file.validatorlib}"/>
	<property file="${validatorlib.basedir}/validator.properties"/>
	
	<!-- Import the catalog to use for validation - configured in validator.properties -->
	<echo message="Using XML catalog ${validatorlib.basedir}/${catalog}"/>
	<import file="${validatorlib.basedir}/${catalog}"/>
	
    <!-- = = = = = = = = = = = = = = = = =
    macrodef: validate
    = = = = = = = = = = = = = = = = = -->	
	<macrodef name="validate">
        <attribute name="input"/>
        <attribute name="logdir" default="."/>
		<attribute name="logfilename" default="validatedita.log"/>
		<attribute name="report" default="yes"/>
		<attribute name="reportdir" default="."/>
		<attribute name="reportfilename" default="validation_report.txt"/>
		<sequential>
			<validatedita  input="@{input}" logdir="@{logdir}" logfilename="@{logfilename}"/>
			<if>
				<equals arg1="@{report}" arg2="yes" />
				<then>
					<validation_report input="@{logdir}/@{logfilename}" reportdir="@{reportdir}" reportfilename="@{reportfilename}"/>
				</then>
			</if>
		</sequential>
	</macrodef>
	
    <!-- = = = = = = = = = = = = = = = = =
    macrodef: validatedita
    = = = = = = = = = = = = = = = = = -->
    <macrodef name="validatedita">
        <attribute name="input"/>
        <attribute name="logdir" default="."/>
		<attribute name="logfilename" default="validatedita.log"/>
        
        <sequential>
			<record name="@{logdir}/@{logfilename}" loglevel="error" action="start"/>
	        <xmlvalidate failonerror="no">
                <fileset dir="@{input}">
                  <include name="**/*.*"/>
                </fileset>
				<xmlcatalog refid="${catalog-id}"/>
	        </xmlvalidate>
	        <record name="@{logdir}/@{logfilename}" action="stop"/>
        </sequential>
    </macrodef>
	
    <!-- = = = = = = = = = = = = = = = = =
    macrodef: validation_report
    = = = = = = = = = = = = = = = = = -->	
    <macrodef name="validation_report">
		<!-- "input" is a log file from ant's xmlvalidate task -->
        <attribute name="input"/>
        <attribute name="reportdir" default="."/>
		<attribute name="reportfilename" default="validation_report.txt"/>
		<sequential>
			<exec executable="python" append="true">
				<arg value="${validatorlib.basedir}/validation_report.py"/>
				<arg value="-r"/>
				<arg value="@{reportdir}/@{reportfilename}"/>
				<arg value="@{input}"/>
			</exec>
		</sequential>
	</macrodef>
	
</project>